<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoTrade Professional</title>
    <link rel="stylesheet" href="/static/index.css?v=2">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Dashboard Header -->
        <header class="top-bar">
            <div class="logo-area">
                <div class="logo-icon">EA</div>
                <div class="logo-text">AutoTrade</div>
            </div>
            <div class="status-bar">
                <div class="market-ticker" id="market-ticker" style="display:none;">
                    <span class="ticker-item">SPY <span id="spy-val" class="ticker-value">---</span></span>
                    <span class="ticker-item" style="border-left: 1px solid #334155; padding-left: 20px;">VIX <span
                            id="vix-val" class="ticker-value">---</span></span>
                </div>
                <div style="width: 1px; height: 24px; background: #334155; margin: 0 10px;"></div>
                <span id="mode-badge" class="mode-badge">PAPER TRADING</span>
                <span class="connection-status">
                    <span id="ib-status-dot" class="status-dot"></span>
                    <span id="ib-status-text">IB Connection: Checking...</span>
                </span>
                <div style="width: 32px; height: 32px; background: #334155; border-radius: 50%;"></div>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <main class="dashboard-grid">

            <!-- LEFT COLUMN: Account & Market Stats -->
            <section class="col-left">
                <!-- Total Equity -->
                <div class="card value-display">
                    <div class="card-header">
                        <span class="value-label">Total Equity</span>
                        <i data-lucide="wallet" class="card-icon"></i>
                    </div>
                    <div class="value-number" id="equity-val">$0.00</div>
                    <div class="value-sub positive">
                        <i data-lucide="trending-up" width="14"></i>
                        <span id="pnl-percent-today">+0.00% Today</span>
                    </div>
                </div>

                <!-- Buying Power -->
                <div class="card value-display">
                    <div class="card-header">
                        <span class="value-label">Buying Power</span>
                        <i data-lucide="zap" class="card-icon"></i>
                    </div>
                    <div class="value-number" id="bp-val">$0.00</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="bp-progress" style="width: 0%"></div>
                    </div>
                    <div class="utilization-text"><span id="bp-util">0</span>% Utilized</div>
                </div>

                <!-- Daily P&L -->
                <div class="card value-display">
                    <div class="card-header">
                        <span class="value-label">Daily P&L</span>
                        <i data-lucide="bar-chart-2" class="card-icon"></i>
                    </div>
                    <div class="value-number text-green" id="daily-pnl-total">+$0.00</div>
                    <div class="pnl-grid">
                        <div class="pnl-box">
                            <div class="pnl-box-label">REALIZED</div>
                            <div class="pnl-box-value text-green" id="pnl-realized">+$0.00</div>
                        </div>
                        <div class="pnl-box">
                            <div class="pnl-box-label">UNREALIZED</div>
                            <div class="pnl-box-value text-green" id="pnl-unrealized">+$0.00</div>
                        </div>
                    </div>
                </div>

                <!-- Market Status -->
                <div class="card market-status-card">
                    <div class="card-header">
                        <div class="card-title text-accent-blue" id="market-status-title">MARKET CHECK</div>
                        <span class="market-indicator status-dot" id="market-status-dot"></span>
                    </div>
                    <div class="value-label" style="margin: 0;" id="market-status-text">Checking...</div>
                    <div class="value-sub" style="padding:0; margin-top: 4px; color: #94a3b8; background:none;"
                        id="market-status-sub">
                        --:--
                    </div>
                </div>
            </section>

            <!-- MIDDLE COLUMN: Active Positions & Strategies -->
            <section class="col-middle">

                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
                    <button class="nav-tab" onclick="switchTab('history')">Trade History</button>
                </div>

                <div id="tab-dashboard">
                    <!-- Positions Header -->
                    <div class="card-header" style="margin-bottom: 0;">
                        <h3 class="card-title"><i data-lucide="layers" width="18" style="margin-right:8px;"></i> Open
                            Positions</h3>
                        <span class="mode-badge" style="background:#334155; color:#f8fafc;" id="pos-count-badge">0
                            Active</span>
                    </div>

                    <!-- Positions List (Table Layout) -->
                    <div class="card" style="padding: 0; overflow: hidden; border: 1px solid var(--divider);">
                        <table class="simple-table">
                            <thead>
                                <tr>
                                    <th style="padding-left: 16px;">Symbol</th>
                                    <th style="text-align:right">Qty</th>
                                    <th style="text-align:right">Avg Cost</th>
                                    <th style="text-align:right">Last</th>
                                    <th style="text-align:right">P&L</th>
                                    <th style="text-align:right">Value</th>
                                    <th style="text-align:right; padding-right: 16px;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="positions-table-body">
                                <!-- Dynamic Positions Inserted Here -->
                            </tbody>
                        </table>
                        <div id="no-positions-msg"
                            style="text-align:center; padding: 20px; color: #64748b; display:none;">
                            No active positions
                        </div>
                    </div>

                    <!-- Pending Orders -->
                    <div class="card-header" style="margin-top: 20px; margin-bottom: 12px;">
                        <h3 class="card-title"><i data-lucide="clock" width="18" style="margin-right:8px;"></i> Pending
                            Orders</h3>
                        <span class="mode-badge" style="background:#334155; color:#f8fafc;"
                            id="pending-orders-badge">0</span>
                    </div>

                    <div id="pending-orders-list" class="strategy-list">
                        <div style="text-align:center; padding: 20px; color: #64748b;">No pending orders</div>
                    </div>

                    <!-- Active Strategies -->
                    <div class="card-header" style="margin-top: 20px; margin-bottom: 12px;">
                        <h3 class="card-title"><i data-lucide="cpu" width="18" style="margin-right:8px;"></i> Active
                            Strategies</h3>
                        <button
                            style="background:var(--accent-blue); border:none; color:white; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:0.75rem;">Add
                            Strategy</button>
                    </div>

                    <div class="strategy-list">
                        <div class="strategy-item running">
                            <div class="strat-info">
                                <h4>Telegram Signal Listener</h4>
                                <p>Monitoring Channel @Signals</p>
                            </div>
                            <div class="strat-status status-running">RUNNING</div>
                        </div>
                        <div class="strategy-item idle">
                            <div class="strat-info">
                                <h4>Mean Reversion</h4>
                                <p>Waiting for setup</p>
                            </div>
                            <div class="strat-status status-idle">IDLE</div>
                        </div>
                    </div>

                </div> <!-- End Dashboard Tab -->

                <div id="tab-history" style="display:none;">
                    <div class="card-header">
                        <h3 class="card-title"><i data-lucide="history" width="18" style="margin-right:8px;"></i>
                            Today's Trades</h3>
                        <button onclick="updateHistory()"
                            style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i
                                data-lucide="refresh-cw" width="14"></i></button>
                    </div>
                    <div class="card" style="padding:0;">
                        <table class="simple-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Action</th>
                                    <th>Ticker</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                                <tr>
                                    <td colspan="6" style="text-align:center; padding:20px;">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </section>

            <!-- RIGHT COLUMN: Logs Only -->
            <section class="col-right">
                <!-- System Logs -->
                <div class="card" style="flex-grow: 1;">
                    <div class="card-header">
                        <h3 class="card-title"><i data-lucide="terminal" width="18" style="margin-right:8px;"></i>
                            System Logs</h3>
                        <div class="status-dot active"></div>
                    </div>
                    <div class="logs-container" id="logs-feed">
                        <!-- Dynamic Logs -->
                        <div class="log-entry">
                            <span class="log-time">[System]</span>
                            <span class="log-msg">Dashboard initialized.</span>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>
    <script src="/static/app.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>